<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Produtos - ClickDivulga</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/grupos.css') }}">
</head>
<body>
  <div class="sidebar">
    <h2>ClickDivulga</h2>
    <div class="menu">
      <a href="/painel"><i>🏠</i> Dashboard</a>
      <a href="/criar-link"><i>➕</i> Criar Link</a>
      <a href="/grupos"><i>📊</i> Desempenho de Grupos</a>
      <a href="/produtos" class="active"><i>🛍️</i> Produtos</a>
      <a href="/minha-api"><i>🔐</i> API Shopee</a>
      <a href="/logout"><i>🚪</i> Sair</a>
    </div>
  </div>

  <div class="content">
    <div class="topbar">
      <h1>🛍️ Buscar Produtos com Comissão</h1>
    </div>

    <!-- 🔍 Formulário de busca -->
    <div style="background:white; padding: 30px; border-radius: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 40px; max-width: 700px;">
      <h2 style="margin-bottom: 20px; color: #5e3ea1;">🔎 Pesquisar Produto da Shopee</h2>

      <form method="POST" action="/buscar-produto" onsubmit="return validarCampos();">
        <div style="margin-bottom: 20px;">
          <label style="font-weight: 600;">Buscar por palavra-chave:</label>
          <input type="text" name="keyword" id="campoKeyword" placeholder="ex: ring light, whey, bermuda" style="width: 100%; padding: 10px; margin-top: 6px; border: 1px solid #ccc; border-radius: 8px; font-size: 1rem;">
        </div>

        <div style="margin-bottom: 20px;">
          <label style="font-weight: 600;">Ou cole um link direto da Shopee:</label>
          <input type="url" name="url" id="campoUrl" placeholder="https://shopee.com.br/..." style="width: 100%; padding: 10px; margin-top: 6px; border: 1px solid #ccc; border-radius: 8px; font-size: 1rem;">
        </div>

        <button type="submit" style="background-color: #5e3ea1; color: white; border: none; padding: 12px 20px; border-radius: 8px; font-size: 1rem; cursor: pointer;">🔍 Buscar Produto</button>
      </form>
    </div>

    {% if produtos %}
    <!-- 🧾 Lista de Produtos -->
    <div style="background:white; padding:30px; border-radius:16px; box-shadow:0 2px 8px rgba(0,0,0,0.05); margin-top: 40px;">
      <h2 style="margin-bottom:20px;">🧾 Produtos Encontrados</h2>
      <div style="display: flex; flex-wrap: wrap; gap: 20px; justify-content: flex-start;">
        {% for produto in produtos %}
        <div style="background: #f8f8fc; padding: 20px; border-radius: 12px; width: 240px; border: 1px solid #e3dfff;">
          <img src="{{ produto.imagem }}" alt="Produto" style="width:100%; height:160px; object-fit:cover; border-radius:8px; margin-bottom: 10px;">
          <strong style="font-size: 0.95rem;">{{ produto.titulo }}</strong><br>
          <small style="color:#666;">💰 R$ {{ produto.preco }}</small><br>
          <small style="color:#666;">🏪 {{ produto.loja }}</small><br>
          <small style="color:#666;">💵 Comissão: {{ produto.comissao | round(1) }}%</small><br><br>
          <input type="text" value="{{ produto.link }}" readonly style="width:100%; padding:8px; font-size:0.9rem; margin-bottom:6px; border-radius: 6px; border: 1px solid #ccc;">
          <button onclick="navigator.clipboard.writeText('{{ produto.link }}'); this.textContent='✅ Copiado!';" class="btn" style="width: 100%;">📋 Copiar Link</button>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </div>

  <!-- Validação para garantir que pelo menos um campo esteja preenchido -->
  <script>
    function validarCampos() {
      const keyword = document.getElementById("campoKeyword").value.trim();
      const url = document.getElementById("campoUrl").value.trim();

      if (!keyword && !url) {
        alert("Preencha pelo menos a palavra-chave ou o link da Shopee.");
        return false;
      }
      return true;
    }
  </script>
</body>
</html>
