<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Desempenho de Grupos - ClickDivulga</title>
  <link rel="stylesheet" href="../static/css/grupos.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="sidebar">
    <h2>ClickDivulga</h2>
    <div class="menu">
      <a href="/painel"><i>üè†</i> Dashboard</a>
      <a href="/criar-link"><i>‚ûï</i> Criar Link</a>
      <a href="/grupos" class="active"><i>üìä</i> Desempenho de Grupos</a>
      <a href="/logout"><i>üö™</i> Sair</a>
    </div>
  </div>

  <div class="content">
    <div class="topbar">
      <h1>üìä Desempenho de Grupos no WhatsApp</h1>
    </div>

    <table class="group-table">
      <thead>
        <tr>
          <th>Slug</th>
          <th>Link</th>
          <th>Cliques</th>
          <th>Entradas (manual)</th>
          <th>Taxa de Convers√£o</th>
          <th>A√ß√£o</th>
        </tr>
      </thead>
      <tbody>
        {% for grupo in grupos %}
        <tr>
          <td>{{ grupo.slug }}</td>
          <td><a href="/r/{{ grupo.slug }}" target="_blank">Abrir</a></td>
          <td>{{ grupo.cliques }}</td>
          <td>
            <form method="POST" action="/atualizar-entradas">
              <input type="hidden" name="slug" value="{{ grupo.slug }}">
              <input type="number" name="entradas" value="{{ grupo.entradas }}" min="0" class="entrada-input">
              <button type="submit">Salvar</button>
            </form>
          </td>
          <td>{{ grupo.conversao }}%</td>
          <td><a href="/r/{{ grupo.slug }}" target="_blank">Copiar Link</a></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <hr style="margin: 40px 0;">

    <h2 style="margin-bottom: 20px;">‚è±Ô∏è Distribui√ß√£o de Cliques por Hor√°rio</h2>
    <div style="background:white; padding:20px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1);">
      <canvas id="graficoCliques"></canvas>
    </div>
  </div>

  <script>
    const cliques = {{ cliques | tojson }};
    const labels = [...Array(24).keys()].map(h => h.toString().padStart(2, '0') + ":00");

    const ctx = document.getElementById('graficoCliques').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: 'Cliques por hora',
          data: cliques,
          backgroundColor: '#5e3ea1'
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true }
        }
      }
    });
  </script>
</body>
</html>
